{% extends 'base.html.twig' %}

{% block title %}
Commande n°{{ order.id }} - TouSolidaires
{% endblock %}

{% block body %}
    {% include 'navbar.html.twig' with {'active': 'user'} %}
    <div class="container order-container">
        <div class="order">
            <h2 class="text-center">Commande n°{{ order.id }}</h2>
            <h6 class="mx-1"><i class="bi-shop-window"></i> Informations de la boutique</h6>
            <div class="shop mt-3">
                <h4 class="mb-1">{{ shop.name }}</h4>
                <p class="mb-1"><i class="bi-geo"></i> Adresse : {{ shop.address }} {{ shop.postalCode }} {{ shop.city }}</p>
                {% set splitArray = shop.phone|split('', 1) %}
                {% set first = splitArray|first %}
                {% set firstArray =  [0, first] | join('') %}
                {% set splitArray = splitArray|slice(1) %}
                {% set splitArray = splitArray|join('') %}
                {% set lastArray = [firstArray, splitArray] |join('') %}
                {% set finalSplit = lastArray|split('', 2) %}
                {% set formattedString = finalSplit|join(' ') %}
                <a href="tel:{{ formattedString }}" class="mb-0"><i class="bi-telephone"></i> Téléphone : {{ formattedString }}</a>
            </div>
            <h6 class="mt-3 mb-2"><i class="bi-info-circle"></i> Informations de la commande</h6>
            <div class="horaires mt-2">
                {% if order.day != null and order.timeBegin != null and order.timeEnd != null %}
                <p class="card-text mb-0"><i class="bi-calendar3"></i> Date de retrait : {{ order.day | format_date(locale="fr") }}</p>
                <p class="card-text"><i class="bi-clock"></i> Horaire de retrait :
                    {{ order.timeBegin | format_time('short',pattern="HH'h'mm", locale='fr') }}
                    - {{ order.timeEnd | format_time('short',pattern="HH'h'mm", locale='fr') }}
                </p>
                {% elseif order.status == 0 %}
                <p class="card-text">La date et le créneau de retrait vous seront communiqués une fois la commande validée par le commerçant.</p>
                {% else %}
                <p class="card-text">La date et le créneau de retrait vous ont été communiqués par un autre moyen par le commerçant.</p>
                {% endif %}
            </div>
            <h6 class="mt-3 mb-2"><i class="bi-box-seam"></i> Les produits présents dans la commande</h6>
            <table class="table table-light table-striped text-center mt-3">
                <thead>
                <tr>
                    <th>Nom</th>
                    <th>Prix</th>
                    <th>Quantité</th>
                </tr>
                </thead>
                <tbody>
                {% set i = 0 %}
                {% for product in products %}
                <tr>
                    <td>{{ product.name }}</td>
                    <td>{{ product.price | format_currency('EUR') }}</td>
                    <td>x{{ quantities[i] }}</td>
                    {% set i = i + 1 %}
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="order-status">
            <h3 class="mb-1"><i class="bi-truck"></i> &Eacute;tat de la commmande</h3>
            <ul class="list-unstyled multi-steps">
                <li class="{% if order.status == 0 %}is-active{% endif %}">Commande en attente de validation par le commerçant</li>
                <li class="{% if order.status == 1 %}is-active{% endif %}">Commande en cours de préparation</li>
                <li class="{% if order.status == 2 %}is-active{% endif %}">Commande prête</li>
                <li class="{% if order.status == 4 %}{% elseif order.status == 3 %}is-active{% endif %}">Commande récupérée</li>
            </ul>
        </div>
    </div>
    {% include 'footer.html.twig' %}
{% endblock %}
