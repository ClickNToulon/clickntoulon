{% extends 'base.html.twig' %}

{% block title %}
Commande n°{{ order.id }} - ClickNToulon
{% endblock %}

{% block body %}
    {% include 'navbar.html.twig' with {'active': 'user-orders'} %}
    <section>
        <div class="sm:container px-5 pt-12 mx-auto flex flex-wrap">
            <div class="flex flex-wrap">
                <div class="w-full rounded-xl md:mt-0 mt-12 bg-white dark:bg-darkblue-800 shadow-2xl dark:shadow-none">
                    <div class="flex flex-col p-4 w-full">
                        <div class="w-full flex flex-col items-center justify-center">
                            <h1 class="text-3xl text-black dark:text-white font-bold title-font title-underline">Commande #{{ order.orderNumber }}</h1>
                            <h2 class="text-gray-400 text-lg font-bold mt-1">{{ order.day | format_date(pattern='dd MMMM y',locale='fr') }}</h2>
                            <div class="flex items-center justify-between mt-3 space-x-4">
                                {% if order.status == 0 %}
                                    <span class="px-3 py-1 inline-flex text-lg font-bold rounded-full bg-accent-red text-red-700">
                                        En attente
                                    </span>
                                {% elseif order.status == 1 %}
                                    <span class="px-3 py-1 inline-flex text-lg font-bold rounded-full bg-accent-yellow text-yellow-700">
                                        Validée
                                    </span>
                                {% elseif order.status == 2 %}
                                    <span class="px-3 py-1 inline-flex text-lg font-bold rounded-full bg-accent-green text-green-700">
                                        Prête
                                    </span>
                                {% elseif order.status == 3 %}
                                    <span class="px-3 py-1 inline-flex text-lg font-bold rounded-full bg-blue-200 text-blue-700">
                                        Récupérée
                                    </span>
                                {% endif %}
                                <span class="inline-flex text-2xl font-bold text-white">{{ order.total | format_currency('EUR') }}</span>
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <div class="mt-3">
                                <div class="px-4 pb-1 sm:px-6 flex items-center justify-center flex-col">
                                    <a href="{{ path('shop_show', {slug: order.shop.slug}) }}">
                                        <button class="w-auto flex items-center justify-center px-3 py-1 font-bold rounded-full text-white border-2 border-blue-900 hover:bg-blue-900">
                                            Voir la boutique
                                            <svg class="w-5 h-5 ml-2" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M5 12h14"></path>
                                                <path d="M12 5l7 7-7 7"></path>
                                            </svg>
                                        </button>
                                    </a>
                                </div>
                                {% set i = 0 %}
                                {% for product in products %}
                                    <div class="px-4 py-5 sm:px-6 space-y-6">
                                        <div class="flex sm:flex-row flex-col">
                                            <div class="w-full sm:w-1/3 pb-2 sm:pb-0">
                                                <img class="rounded-xl border-2 border-blue-500" src="{{ asset('uploads/products/' ~ product.images[0]) }}" alt="">
                                            </div>
                                            <div class="flex flex-col pl-4 w-full">
                                                <div class="flex flex-row justify-between items-center mb-2">
                                                    <h1 class="font-bold text-black dark:text-gray-200 text-2xl">{{ product.name }} (x{{ quantities[i] }})</h1>
                                                    {% if product.unitPriceDiscount is not null %}
                                                        <div class="inline-flex items-center justify-between space-x-3">
                                                            {% set dealPrice = product.unitPrice * (1 - (product.unitPriceDiscount/100)) | round(2) %}
                                                            <p class="text-lg font-bold text-gray-900 dark:text-red-500">{{ dealPrice | format_currency('EUR') }}</p>
                                                            <p class="text-lg font-bold bg-accent-red text-red-700 rounded-full px-2.5 py-0.25">-{{ product.unitPriceDiscount }}%</p>
                                                        </div>
                                                    {% else %}
                                                        <p class="text-lg font-bold text-gray-900 dark:text-gray-200">{{ product.unitPrice | format_currency('EUR') }}</p>
                                                    {% endif %}
                                                    {% set i = i + 1 %}
                                                </div>
                                                <div class="h-full relative">
                                                    <p class="text-base font-semibold text-black dark:text-gray-200">
                                                        {{ product.description }}
                                                    </p>
                                                </div>
                                                <div class="w-full flex justify-center tablet:justify-end pt-4 tablet:pt-0">
                                                    <a href="{{ path('product_show', {id: product.id}) }}" class="text-white border-2 border-blue-900 hover:bg-blue-900 font-bold px-3 py-1 rounded-full transition-all duration-500">Voir le produit</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% include 'footer.html.twig' %}
{% endblock %}
