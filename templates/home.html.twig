{% extends 'base.html.twig' %}

{% block title 'TouSolidaires - Le site des achats solidaires' %}

{% block body %}
    {% include 'navbar.html.twig' with {'active': 'home'} %}
    {% if user is defined and user == null %}
    <div class="container-fluid hero">
        <div class="row flex-lg-row-reverse align-items-center g-5 py-5">
            <div class="col-10 col-sm-8 col-lg-6">
                <img src="{{ asset('images/logo-home.svg') }}" class="d-block mx-lg-auto img-fluid" alt="Logo Noir"
                     width="500" height="450" loading="lazy">
            </div>
            <div class="col-lg-6">
                <h1 class="display-5 fw-bold lh-1 mb-3">TouSolidaires, le site des achats solidaires</h1>
                <p class="lead">
                    TouSolidaires est une plateforme associative qui fonctionne 24h/24 7j/7.
                    <br>
                    Réalisé par des étudiants de l’ISEN de Toulon, le but est de venir en aide aux commerçants toulonnais.
                </p>
                <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                    <a href="{{ path('app_signup') }}"><button type="button" class="fr-btn btn-home arrow-icon">Créer votre compte</button></a>
                    <a href="{{ path('about_index') }}"><button type="button" class="fr-btn fr-btn--secondary btn-home-outline">Qui sommes-nous ?</button></a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
        <div class="container-fluid hero">
            <div class="row flex-lg-row-reverse align-items-center g-5 py-5">
                <div class="col-10 col-sm-8 col-lg-6">
                    <img src="{{ asset('images/logo-home.svg') }}" class="d-block mx-lg-auto img-fluid" alt="Logo Noir"
                         width="500" height="450" loading="lazy">
                </div>
                <div class="col-lg-6">
                    <div class="d-flex flex-row justify-content-center">
                        <img class="d-block me-3" src="{% if user.avatar %}{{ asset('uploads/users/') ~ user.avatar }}{% else %}{{ asset('images/logo-home.svg') }}{% endif %}" alt="" width="125" height="125">
                        <h1 class="display-5 fw-bold align-self-center">
                            Bienvenue
                            <br>
                            {{ user.fullName }}
                        </h1>
                    </div>
                    <div class="d-grid gap-4 d-md-flex justify-content-md-center">
                        <a href="{{ path('user_orders') }}"><button class="fr-btn btn-home">Mes commandes</button></a>
                        <a href="{{ path('user_edit') }}"><button class="fr-btn fr-btn--secondary btn-home-outline">Mes informations</button></a>
                        <a href="{{ path('basket_index') }}"><button class="fr-btn fr-btn--secondary btn-home-outline">Mon panier</button></a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="container-md">
        <div class="row gx-4">
            {% for shop in shops %}
                <div class="col-12 col-md-6">
                    <div class="card card-bleed mb-6 mb-xl-0 shadow-light-lg home-shop">
                        <a class="card-img-top" href="{{ path('shop_show', {slug: shop.slug}) }}">
                            <img src="{{ asset('uploads/shops/' ~ shop.cover) }}" alt="..." class="img-fluid" style="border-top-left-radius: 10px;border-top-right-radius: 10px">
                        </a>
                        <div class="position-relative w-100">
                            <div class="shape shape-fluid-x shape-bottom text-white">
                                <svg viewBox="0 0 2880 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 48h2880V0h-720C1442.5 52 720 0 720 0H0v48z" fill="currentColor"></path></svg>                    </div>
                        </div>
                        <a class="card-body" href="{{ path('shop_show', {slug: shop.slug}) }}">
                            <h3 class="mb-2">
                                {{ shop.name | u.truncate(40, '...', false) }}
                            </h3>
                            <p class="mb-2 text-black text-justify">
                                {{ shop.description | u.truncate(150, '...', false) }}
                            </p>
                            <p class="mb-1 text-black text-justify">
                                <i class="bi-geo"></i> Adresse : {{ shop.address }} {{ shop.postalcode }} {{ shop.city }}
                            </p>
                            {% set splitArray = shop.phone|split('', 1) %}
                            {% set first = splitArray|first %}
                            {% set firstArray =  [0, first] | join('') %}
                            {% set splitArray = splitArray|slice(1) %}
                            {% set splitArray = splitArray|join('') %}
                            {% set lastArray = [firstArray, splitArray] |join('') %}
                            {% set finalSplit = lastArray|split('', 2) %}
                            {% set formattedString = finalSplit|join(' ') %}
                            <p class="mb-1 text-black text-justify">
                                <i class="bi-telephone"></i> Téléphone : {{ formattedString }}
                            </p>
                            {% if shop.email != null %}
                                <p class="mb-1 text-black text-justify">
                                    <i class="bi-envelope"></i> Email : {{ shop.email }}
                                </p>
                            {% endif %}
                        </a>
                        <a class="card-meta w-100" href="{{ path('shop_show', {slug: shop.slug}) }}">
                            <hr class="card-meta-divider w-100">
                            <div class="meta-info d-flex justify-content-center align-items-center">
                                <ul class="fr-tags-group fr-card__detail p-2 ps-3">
                                    <li>
                                    <span class="fr-tag">
                                        <i class="bi-tags-fill me-1"></i>{{ shop.tagName }}
                                    </span>
                                    </li>
                                    <li>
                                        {% if shop.status == 2 %}
                                            <span class="fr-tag">Boutique partenaire <span class="admin-badge ms-1 me-0"><i class="fad fa-badge-check"></i></span></span>
                                        {% elseif shop.status == 1 %}
                                            <span class="fr-tag">Boutique vérifiée</span>
                                        {% else %}
                                            <span class="fr-tag">Boutique non vérifiée</span>
                                        {% endif %}
                                    </li>
                                </ul>
                                <p class="h6 text-uppercase text-muted ms-auto me-4 mb-2 arrow-icon">
                                    <i class="arrow-right"></i>
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="container-md py-10">
        <div class="row gy-4">
            {% for product in products %}
                <div class="col-12 col-md-3">
                    <div class="card card-bleed mb-6 mb-xl-0 shadow-light-lg home-product">
                        <a class="card-img-top" href="{{ path('product_show', {id: product.id}) }}">
                            <img src="{{ asset('uploads/products/' ~ product.image) }}" alt="..." class="img-fluid">
                        </a>
                        <div class="position-relative w-100">
                            <div class="shape shape-fluid-x shape-bottom text-white">
                                <svg viewBox="0 0 2880 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 48h2880V0h-720C1442.5 52 720 0 720 0H0v48z" fill="currentColor"></path></svg>                    </div>
                        </div>
                        <a class="card-body" href="{{ path('product_show', {id: product.id}) }}">
                            <h3>
                                {{ product.name }}
                            </h3>
                            <p class="mb-0 text-muted text-justify">
                                {{ product.description | u.truncate(150, '...', false) }}
                            </p>
                        </a>
                        <a class="card-meta w-100" href="{{ path('product_show', {id: product.id}) }}">
                            <hr class="card-meta-divider w-100">
                            <div class="meta-info d-flex justify-content-center align-items-center">
                                {% if product.dealprice != null %}
                                    <ul class="fr-tags-group fr-card__detail me-auto p-4">
                                        <li>
                                            <span class="fr-tag deal_price product-price">{{ product.price | format_currency('EUR') }}</span>
                                        </li>
                                        <li>
                                            <span class="fr-tag product-price tag-danger">{{ product.dealprice | format_currency('EUR') }}</span>
                                        </li>
                                    </ul>
                                {% else %}
                                    <ul class="fr-tags-group fr-card__detail me-auto p-4">
                                        <li>
                                        <span class="fr-tag product-price">
                                            {{ product.price | format_currency('EUR') }}
                                        </span>
                                        </li>
                                    </ul>
                                {% endif %}
                                <p class="h6 text-uppercase text-muted mb-0 ms-auto me-3 arrow-icon">
                                    <i class="arrow-right"></i>
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            {% endfor %}
            <div class="row">
            </div>
        </div>
        <div class="text-center">
            <a href="{{ path('product_index') }}">
                <button class="fr-btn fr-btn--secondary w-50 btn-home-outline arrow-icon">Voir plus de produits</button>
            </a>
        </div>
    </div>
    {% include('footer.html.twig') %}
{% endblock %}